(()=>{"use strict";var e=".popup__form",t=".popup__button",r="popup__form-error",n=(document.querySelectorAll(".popup"),document.forms.formNewMesto),o=document.querySelector(".profile__edit"),c=document.querySelector(".popup-edit-profile"),a=document.querySelector(".profile__avatar-button"),u=document.querySelector(".popup-avatar"),i=document.forms.formNewAvatar,d=document.querySelector(".profile__add"),l=document.querySelector(".new-item-form"),s=document.querySelector(".profile__name"),m=document.querySelector(".profile__avatar"),v=document.querySelector(".profile__subname"),p=document.querySelector(".elements-grid"),f=document.querySelector(".cards-temlate").content,_=document.querySelector(".img-card-big"),h=_.querySelector(".popup__image"),y=_.querySelector(".popup__caption"),S=document.querySelector("[name=nameInput]"),q=document.querySelector("[name=jobInput]"),k=n.querySelector("[name=mesto-title]"),L=n.querySelector("[name=mesto-link]"),E=i.querySelector("[name=avatar-link]"),b=c.querySelector(e),g=c.querySelector(t),C=l.querySelector(t),A=i.querySelector(t);function U(e){e.classList.add("popup_opened"),document.addEventListener("keydown",N)}function x(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",N)}function N(e){"Escape"===e.code&&x(document.querySelector(".popup_opened"))}p.querySelectorAll(".card__like");var T={serverUrl:"https://nomoreparties.co/v1/plus-cohort-3",headers:{authorization:"a816c82e-39b0-4c48-9647-89203e47e4c6","Content-Type":"application/json"}},w=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function D(){return fetch("".concat(T.serverUrl,"/users/me"),{headers:T.headers}).then(w)}var P=function(e){return fetch("".concat(T.serverUrl,"/cards/likes/").concat(e),{method:"PUT",headers:T.headers}).then(w)},j=function(e){console.log("Ошибка на сервере: ".concat(e))};function O(e){var t=f.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__likes");return t.querySelector(".card__like").addEventListener("click",(function(e){var n;e.target.classList.contains("card__like_active")?(n=t.id,fetch("".concat(T.serverUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:T.headers}).then(w)).then((function(t){e.target.classList.remove("card__like_active"),updateLikesCount(r,t.likes.length)})).catch((function(e){return j(e)})):P(t.id).then((function(t){e.target.classList.add("card__like_active"),updateLikesCount(r,t.likes.length)})).catch((function(e){return j(e)}))})),r.textContent=P.length,t.querySelector(".card__delete-icon").addEventListener("click",(function(){var e;t.remove(),(e=t.id,fetch("".concat(T.serverUrl,"/cards/").concat(e),{method:"DELETE",headers:T.headers}).then(w)).then((function(){evt.target.parentNode.remove()})).catch((function(e){return j(e)}))})),t.querySelector(".card__title").textContent=e.name,t.querySelector(".card__image").src=e.link,t.querySelector(".card__image").alt=e.name,t.id=e._id,t.querySelector(".card__image").addEventListener("click",(function(t){h.src=e.link,h.alt=e.name,y.textContent=e.name,U(_)})),t}var J=function(e,t){!function(e){return e.every((function(e){return e.validity.valid}))}(t)?e.disabled=!0:e.disabled=!1};function H(e){(e.target.classList.contains("popup__close")||e.target.classList.contains("popup"))&&x(e.target.closest(".popup"))}Array.from(document.querySelectorAll(e)).forEach((function(e){!function(e){e.addEventListener("submit",(function(e){e.preventDefault()}));var n=Array.from(e.querySelectorAll(".popup__form-input")),o=e.querySelector(t);J(o,n),n.forEach((function(e){e.addEventListener("input",(function(){(function(e){e.validity.valid?function(e){document.querySelector("#".concat(e.name,"-error")).textContent="",e.classList.remove(r)}(e):function(e){document.querySelector("#".concat(e.name,"-error")).textContent=e.validationMessage,e.classList.add(r)}(e)})(e),J(o,n)}))}))}(e)})),c.addEventListener("submit",(function(e){var t;e.preventDefault(),s.textContent=S.value,v.textContent=q.value,t={name:S.value,about:q.value},fetch("".concat(T.serverUrl,"/users/me"),{method:"PATCH",headers:T.headers,body:JSON.stringify({name:t.name,about:t.about})}),b.reset(),x(c)})),l.addEventListener("submit",(function(e){e.preventDefault();var t=k.value,r={name:t,link:L.value,alt:t};(function(e){var t=O(e);p.prepend(t)})(r),x(l),function(e){fetch("".concat(T.serverUrl,"/cards"),{method:"POST",headers:T.headers,body:JSON.stringify({name:e.name,link:e.link,alt:e.name})}).then(w)}(r),n.reset()})),u.addEventListener("submit",(function(e){var t;e.preventDefault(),m.src=E.value,t={avatar:E.value},fetch("".concat(T.serverUrl,"/users/me/avatar"),{method:"PATCH",headers:T.headers,body:JSON.stringify({avatar:t.avatar})}).then(w),formNewAvatar.reset(),x(u)})),o.addEventListener("click",(function(){U(c),g.disabled=!0})),d.addEventListener("click",(function(){U(l),C.disabled=!0})),a.addEventListener("click",(function(){U(u),A.disabled=!0})),c.addEventListener("click",H),l.addEventListener("click",H),_.addEventListener("click",H),u.addEventListener("click",H);var I=D(),M=fetch("".concat(T.serverUrl,"/cards"),{method:"GET",headers:T.headers}).then(w);Promise.all([I,M]).then((function(e){var t,r;D._id=e[0]._id,t=e[0].name,r=e[0].about,s.textContent=t,v.textContent=r,function(e,t){m.src=t,m.alt="Аватар ".concat(e)}(e[0].name,e[0].avatar),e[1].reverse().forEach((function(e){var t=O(e);p.prepend(t)}))})).catch((function(e){return j(e)}))})();