(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{eY:()=>z});var t=".popup__form",n=".popup__form-input",r=".popup__button",o="popup__form-error",c=(document.querySelectorAll(".popup"),document.forms.formNewMesto),a=document.querySelector(".profile__edit"),i=document.querySelector(".popup-edit-profile"),u=i.querySelector(".popup__button"),l=document.querySelector(".profile__avatar-button"),d=document.querySelector(".popup-avatar"),s=document.forms.formNewAvatar,m=document.querySelector(".profile__add"),v=document.querySelector(".new-item-form"),f=document.querySelector(".profile__name"),p=document.querySelector(".profile__avatar"),_=document.querySelector(".profile__subname"),h=document.querySelector(".elements-grid"),y=document.querySelector(".cards-temlate").content,S=document.querySelector(".img-card-big"),q=S.querySelector(".popup__image"),k=S.querySelector(".popup__caption"),b=document.querySelector("[name=nameInput]"),L=document.querySelector("[name=jobInput]"),E=c.querySelector("[name=mesto-title]"),g=c.querySelector("[name=mesto-link]"),C=s.querySelector("[name=avatar-link]"),x=i.querySelector(t),w=i.querySelector(r),A=v.querySelector(r),U=s.querySelector(r);function N(e){e.classList.add("popup_opened"),document.addEventListener("keydown",O)}function P(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",O)}function T(e){(e.target.classList.contains("popup__close")||e.target.classList.contains("popup"))&&P(e.target.closest(".popup"))}function O(e){"Escape"===e.code&&P(document.querySelector(".popup_opened"))}function j(e){var t=e,n=t.textContent;return function(e){t.textContent=e?"Сохранение...":n}}h.querySelectorAll(".card__like");var D={serverUrl:"https://nomoreparties.co/v1/plus-cohort-3",headers:{authorization:"a816c82e-39b0-4c48-9647-89203e47e4c6","Content-Type":"application/json"}},J=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},H=function(e){console.log("Ошибка на сервере: ".concat(e))};function I(e){var t=y.querySelector(".card").cloneNode(!0);t.id=e._id,t.owner=e.owner,t.querySelector(".card__title").textContent=e.name,t.querySelector(".card__image").src=e.link,t.querySelector(".card__image").alt=e.name;var n=t.querySelector(".card__likes"),r=t.querySelector(".card__like"),o=function(e,t){e.textContent=t};n.textContent=e.likes.length,t.querySelector(".card__like").addEventListener("click",(function(e){var c;e.target.classList.contains("card__like_active")?function(e){return fetch("".concat(D.serverUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:D.headers}).then(J)}(t.id).then((function(e){n.textContent=e.likes.length,r.classList.remove("card__like_active"),o(n,e.likes.length)})).catch(H):(c=t.id,fetch("".concat(D.serverUrl,"/cards/likes/").concat(c),{method:"PUT",headers:D.headers}).then(J)).then((function(e){n.textContent=e.likes.length,r.classList.add("card__like_active"),o(n,e.likes.length)})).catch(H)}));var c=e.likes.some((function(t){return t._id===e.owner._id}));c&&r.classList.add("card__like_active");var a=t.querySelector(".card__delete-icon");return z._id!==t.owner._id&&a.remove(),a.addEventListener("click",(function(){var e;(e=t.id,fetch("".concat(D.serverUrl,"/cards/").concat(e),{method:"DELETE",headers:D.headers}).then(J)).then((function(){t.remove()})).catch(H)})),t.querySelector(".card__image").addEventListener("click",(function(t){q.src=e.link,q.alt=e.name,k.textContent=e.name,N(S)})),t}var M=function(e,t){!function(e){return e.every((function(e){return e.validity.valid}))}(t)?e.disabled=!0:e.disabled=!1};Array.from(document.querySelectorAll(t)).forEach((function(e){!function(e){e.addEventListener("submit",(function(e){e.preventDefault()}));var t=Array.from(e.querySelectorAll(n)),c=e.querySelector(r);M(c,t),t.forEach((function(e){e.addEventListener("input",(function(){(function(e){e.validity.valid?function(e){document.querySelector("#".concat(e.name,"-error")).textContent="",e.classList.remove(o)}(e):function(e){document.querySelector("#".concat(e.name,"-error")).textContent=e.validationMessage,e.classList.add(o)}(e)})(e),M(c,t)}))}))}(e)})),i.addEventListener("submit",(function(e){e.preventDefault();var t,n=j(i.querySelector(r));n(!0),f.textContent=b.value,_.textContent=L.value,(t={name:b.value,about:L.value},fetch("".concat(D.serverUrl,"/users/me"),{method:"PATCH",headers:D.headers,body:JSON.stringify({name:t.name,about:t.about})})).then((function(){u.disabled=!0,x.reset(),P(i)})).catch(H).finally((function(){n(!1)}))})),v.addEventListener("submit",(function(e){e.preventDefault();var t=j(v.querySelector(r));t(!0);var n,o=E.value,a=g.value;(n={name:o,link:a},fetch("".concat(D.serverUrl,"/cards"),{method:"POST",headers:D.headers,body:JSON.stringify({name:n.name,link:n.link})}).then(J)).then((function(e){G(e),h.prepend(I(e)),P(v),c.reset(),w.disabled=!0})).catch(H).finally((function(){t(!1)}))})),d.addEventListener("submit",(function(e){e.preventDefault();var t,n=j(formNewAvatar.querySelector(r));n(!0),p.src=C.value,(t={avatar:C.value},fetch("".concat(D.serverUrl,"/users/me/avatar"),{method:"PATCH",headers:D.headers,body:JSON.stringify({avatar:t.avatar})}).then(J)).then((function(){U.disabled=!0,formNewAvatar.reset(),P(d)})).catch(H).finally((function(){n(!1)}))})),a.addEventListener("click",(function(){N(i),b.value=f.textContent,L.value=_.textContent,w.disabled=!1})),m.addEventListener("click",(function(){N(v),A.disabled=!0})),l.addEventListener("click",(function(){N(d),U.disabled=!0})),i.addEventListener("click",T),v.addEventListener("click",T),S.addEventListener("click",T),d.addEventListener("click",T);var z={};function G(e){var t=I(e);h.append(t)}Promise.all([fetch("".concat(D.serverUrl,"/users/me"),{headers:D.headers}).then(J),fetch("".concat(D.serverUrl,"/cards"),{method:"GET",headers:D.headers}).then(J)]).then((function(e){var t,n;z._id=e[0]._id,t=e[0].name,n=e[0].about,f.textContent=t,_.textContent=n,function(e,t){p.src=t,p.alt="Аватар ".concat(e)}(e[0].name,e[0].avatar,e[0]._id),e[1].forEach((function(e){G(e)}))})).catch(H)})();